#!/bin/bash

SLACK_NOTIFY_VERSION="0.0.2"

if [ -z "$SLACK_WEBHOOK" ]; then
  echo "環境変数SLACK_WEBHOOKを設定してください"
  exit
fi

if [ -p /dev/stdin ]; then

message=`cat -`
message="\`\`\`${message}\`\`\`"

else

message=${1}

fi

data=`cat << EOF
{
  "text": "${message}",
  "blocks": [
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "${message}"
      }
    }
  ]
}
EOF`

curl -H "Content-type: application/json" -s -S -X POST -d "${data}" "${SLACK_WEBHOOK}"
# curl -i -H "Content-type: application/json" -s -S -X POST -d "${data}" "${SLACK_WEBHOOK}"

