#!/bin/bash

SLACK_NOTIFY_VERSION="0.0.3"

if [ -z "$SLACK_WEBHOOK" ]; then
  echo "環境変数SLACK_WEBHOOKを設定してください"
  exit
fi

if [ -p /dev/stdin ]; then

message="\`\`\`$(cat -)\`\`\`"

else

message=""
for x in "$@"
do
  message="${message}\n${x}"
done

fi

data=`cat << EOF
{
  "text": "${message}",
  "blocks": [
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "${message}"
      }
    }
  ]
}
EOF`

curl -H "Content-type: application/json" -s -S -X POST -d "${data}" "${SLACK_WEBHOOK}"
# curl -i -H "Content-type: application/json" -s -S -X POST -d "${data}" "${SLACK_WEBHOOK}"

